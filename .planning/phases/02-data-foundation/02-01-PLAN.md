---
phase: 02-data-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/main/java/com/honeyexplorer/entity/enums/FloralSource.java
  - backend/src/main/java/com/honeyexplorer/entity/enums/HoneyType.java
  - backend/src/main/java/com/honeyexplorer/entity/enums/HoneyOrigin.java
  - backend/src/main/java/com/honeyexplorer/entity/enums/FlavorProfile.java
  - backend/src/main/java/com/honeyexplorer/entity/enums/SourceType.java
  - backend/src/main/java/com/honeyexplorer/entity/enums/Certification.java
  - backend/src/main/java/com/honeyexplorer/entity/BaseAuditEntity.java
  - backend/src/main/java/com/honeyexplorer/entity/Honey.java
  - backend/src/main/java/com/honeyexplorer/entity/LocalSource.java
  - backend/src/main/java/com/honeyexplorer/config/JpaAuditingConfig.java
  - backend/src/main/resources/db/migration/V2__create_honey_tables.sql
autonomous: true

must_haves:
  truths:
    - "Flyway V2 migration creates honeys and local_sources tables in PostgreSQL"
    - "Honey entity can be persisted with all controlled vocabulary fields"
    - "LocalSource entity can be persisted with location and verification metadata"
    - "Audit timestamps (createdAt, updatedAt) are automatically populated on entity save"
  artifacts:
    - path: "backend/src/main/java/com/honeyexplorer/entity/enums/FloralSource.java"
      provides: "Floral source controlled vocabulary"
      contains: "enum FloralSource"
    - path: "backend/src/main/java/com/honeyexplorer/entity/Honey.java"
      provides: "Honey JPA entity"
      contains: "@Entity"
    - path: "backend/src/main/java/com/honeyexplorer/entity/LocalSource.java"
      provides: "LocalSource JPA entity"
      contains: "@Entity"
    - path: "backend/src/main/resources/db/migration/V2__create_honey_tables.sql"
      provides: "Database schema for honey tables"
      contains: "CREATE TABLE honeys"
  key_links:
    - from: "backend/src/main/java/com/honeyexplorer/entity/Honey.java"
      to: "backend/src/main/java/com/honeyexplorer/entity/enums/FloralSource.java"
      via: "@Enumerated(EnumType.STRING)"
      pattern: "@Enumerated.*STRING.*FloralSource"
    - from: "backend/src/main/java/com/honeyexplorer/entity/BaseAuditEntity.java"
      to: "backend/src/main/java/com/honeyexplorer/config/JpaAuditingConfig.java"
      via: "@EnableJpaAuditing enables @CreatedDate/@LastModifiedDate"
      pattern: "@EnableJpaAuditing"
---

<objective>
Create honey taxonomy enums and JPA entities for Honey and LocalSource with full verification metadata

Purpose: Establishes the complete data model for honey discovery, enabling Phase 3 data seeding and Phase 5 filtering. All controlled vocabularies (floral source, origin, type, flavor profile) are defined as Java enums stored as strings for safe evolution.

Output: 6 enum classes, 3 entity classes (BaseAuditEntity, Honey, LocalSource), JPA auditing config, and V2 Flyway migration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-foundation/02-RESEARCH.md
@.planning/phases/01-infrastructure-foundation/01-01-SUMMARY.md
@.planning/phases/01-infrastructure-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create enum classes for controlled vocabularies</name>
  <files>
    backend/src/main/java/com/honeyexplorer/entity/enums/FloralSource.java
    backend/src/main/java/com/honeyexplorer/entity/enums/HoneyType.java
    backend/src/main/java/com/honeyexplorer/entity/enums/HoneyOrigin.java
    backend/src/main/java/com/honeyexplorer/entity/enums/FlavorProfile.java
    backend/src/main/java/com/honeyexplorer/entity/enums/SourceType.java
    backend/src/main/java/com/honeyexplorer/entity/enums/Certification.java
  </files>
  <action>
    Create 6 enum classes in backend/src/main/java/com/honeyexplorer/entity/enums/:

    1. FloralSource.java - Honey floral sources with displayName method:
       CLOVER, WILDFLOWER, MANUKA, ORANGE_BLOSSOM, BUCKWHEAT, ACACIA, LAVENDER,
       TUPELO, SAGE, SOURWOOD, EUCALYPTUS, BLUEBERRY, AVOCADO, LINDEN, CHESTNUT,
       HEATHER, OTHER

    2. HoneyType.java - Processing types:
       RAW, FILTERED, PASTEURIZED, CREAMED, COMB, INFUSED, ORGANIC

    3. HoneyOrigin.java - Country/region origins:
       USA, NEW_ZEALAND, AUSTRALIA, ARGENTINA, MEXICO, CANADA, BRAZIL,
       GREECE, TURKEY, SPAIN, FRANCE, ITALY, HUNGARY, GERMANY, UK, OTHER

    4. FlavorProfile.java - Simplified flavor categories (multi-select):
       SWEET, FLORAL, FRUITY, EARTHY, BOLD, SPICY, MILD, COMPLEX

    5. SourceType.java - Local source types:
       BEEKEEPER, FARM, FARMERS_MARKET, STORE, APIARY, COOPERATIVE

    6. Certification.java - Quality certifications:
       UMF_5_PLUS, UMF_10_PLUS, UMF_15_PLUS, UMF_20_PLUS,
       USDA_GRADE_A, USDA_ORGANIC, TRUE_SOURCE, NON_GMO

    Each enum should have:
    - private String displayName field
    - constructor setting displayName
    - getDisplayName() method
    - displayName should be human-readable (e.g., "Orange Blossom" for ORANGE_BLOSSOM)
  </action>
  <verify>
    All 6 enum files compile successfully:
    cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn compile -q
  </verify>
  <done>
    6 enum classes exist in entity/enums/ with displayName methods
  </done>
</task>

<task type="auto">
  <name>Task 2: Create JPA entities with auditing</name>
  <files>
    backend/src/main/java/com/honeyexplorer/config/JpaAuditingConfig.java
    backend/src/main/java/com/honeyexplorer/entity/BaseAuditEntity.java
    backend/src/main/java/com/honeyexplorer/entity/Honey.java
    backend/src/main/java/com/honeyexplorer/entity/LocalSource.java
  </files>
  <action>
    1. Create JpaAuditingConfig.java in config/:
       - @Configuration
       - @EnableJpaAuditing
       - Empty class body (no AuditorAware needed yet)

    2. Create BaseAuditEntity.java (abstract @MappedSuperclass):
       - UUID id with @GeneratedValue(strategy = GenerationType.UUID)
       - @CreatedDate LocalDateTime createdAt (nullable=false, updatable=false)
       - @LastModifiedDate LocalDateTime updatedAt (nullable=false)
       - LocalDateTime lastVerifiedAt (nullable, for data freshness)
       - String verificationSource (nullable, source of last verification)
       - Boolean isVerified = false
       - @EntityListeners(AuditingEntityListener.class)
       - Use Lombok @Getter @Setter @NoArgsConstructor

    3. Create Honey.java entity extending BaseAuditEntity:
       - @Entity @Table(name = "honeys")
       - String name (nullable=false)
       - String description (length=500)
       - @Enumerated(EnumType.STRING) FloralSource floralSource (nullable=false)
       - @Enumerated(EnumType.STRING) HoneyType type (nullable=false)
       - @Enumerated(EnumType.STRING) HoneyOrigin origin (nullable=false)
       - String region (nullable, more specific than origin)
       - String flavorProfiles (length=200, comma-separated flavor profile values)
       - String imageUrl (length=500)
       - String thumbnailUrl (length=500)
       - String brand (length=100)
       - BigDecimal priceMin (precision=10, scale=2)
       - BigDecimal priceMax (precision=10, scale=2)
       - String certifications (length=200, comma-separated)
       - Integer umfRating (nullable, Manuka only)
       - Integer mgoRating (nullable, Manuka only)
       - String slug (length=200, for SEO URLs)
       - Use Lombok annotations

    4. Create LocalSource.java entity extending BaseAuditEntity:
       - @Entity @Table(name = "local_sources")
       - String name (nullable=false)
       - @Enumerated(EnumType.STRING) SourceType sourceType (nullable=false)
       - String description (length=1000)
       - String address (nullable=false)
       - String city, String state, String zipCode (length=10)
       - Double latitude, Double longitude (nullable=false)
       - String phone (length=20), String email, String website
       - String hoursJson (columnDefinition="TEXT", stores JSON like {"mon":"9-5"})
       - String heroImageUrl (length=500)
       - String thumbnailUrl (length=500)
       - String instagramHandle (length=100)
       - String facebookUrl
       - Boolean isActive = true
       - Use Lombok annotations
  </action>
  <verify>
    Backend compiles with all entities:
    cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn compile -q
  </verify>
  <done>
    JpaAuditingConfig enables auditing, BaseAuditEntity provides shared fields, Honey and LocalSource entities are complete with all attributes from research
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Flyway V2 migration and verify schema</name>
  <files>
    backend/src/main/resources/db/migration/V2__create_honey_tables.sql
  </files>
  <action>
    Create V2__create_honey_tables.sql migration that creates:

    1. honeys table:
       - id UUID PRIMARY KEY
       - name VARCHAR(255) NOT NULL
       - description VARCHAR(500)
       - floral_source VARCHAR(50) NOT NULL
       - type VARCHAR(30) NOT NULL
       - origin VARCHAR(30) NOT NULL
       - region VARCHAR(100)
       - flavor_profiles VARCHAR(200)
       - image_url VARCHAR(500)
       - thumbnail_url VARCHAR(500)
       - brand VARCHAR(100)
       - price_min DECIMAL(10,2)
       - price_max DECIMAL(10,2)
       - certifications VARCHAR(200)
       - umf_rating INT
       - mgo_rating INT
       - slug VARCHAR(200)
       - created_at TIMESTAMP NOT NULL
       - updated_at TIMESTAMP NOT NULL
       - last_verified_at TIMESTAMP
       - verification_source VARCHAR(255)
       - is_verified BOOLEAN DEFAULT FALSE

    2. local_sources table:
       - id UUID PRIMARY KEY
       - name VARCHAR(255) NOT NULL
       - source_type VARCHAR(30) NOT NULL
       - description TEXT
       - address VARCHAR(255) NOT NULL
       - city VARCHAR(100)
       - state VARCHAR(50)
       - zip_code VARCHAR(10)
       - latitude DOUBLE PRECISION NOT NULL
       - longitude DOUBLE PRECISION NOT NULL
       - phone VARCHAR(20)
       - email VARCHAR(255)
       - website VARCHAR(255)
       - hours_json TEXT
       - hero_image_url VARCHAR(500)
       - thumbnail_url VARCHAR(500)
       - instagram_handle VARCHAR(100)
       - facebook_url VARCHAR(255)
       - is_active BOOLEAN DEFAULT TRUE
       - created_at TIMESTAMP NOT NULL
       - updated_at TIMESTAMP NOT NULL
       - last_verified_at TIMESTAMP
       - verification_source VARCHAR(255)
       - is_verified BOOLEAN DEFAULT FALSE

    3. Indexes for common queries:
       - idx_honeys_floral_source ON honeys(floral_source)
       - idx_honeys_type ON honeys(type)
       - idx_honeys_origin ON honeys(origin)
       - idx_honeys_slug ON honeys(slug)
       - idx_local_sources_source_type ON local_sources(source_type)
       - idx_local_sources_state ON local_sources(state)
       - idx_local_sources_location ON local_sources(latitude, longitude)

    After creating migration, verify it works by running the backend with H2:
    cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn spring-boot:run -Dspring-boot.run.profiles=dev &
    Wait for startup, then check health endpoint and stop the process.
  </action>
  <verify>
    Backend starts with H2 and Flyway applies V2 migration:
    - Start: cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn spring-boot:run -Dspring-boot.run.profiles=dev (background for 15 seconds)
    - Check logs contain "Successfully applied 2 migrations" or similar
    - curl http://localhost:8080/api/health returns {"status":"healthy",...}
    - Kill the process
  </verify>
  <done>
    V2 migration creates honeys and local_sources tables with all columns and indexes, Flyway applies it successfully on startup
  </done>
</task>

</tasks>

<verification>
Phase 2 Plan 01 verification:
1. All 6 enum files exist in backend/src/main/java/com/honeyexplorer/entity/enums/
2. JpaAuditingConfig.java exists with @EnableJpaAuditing
3. BaseAuditEntity.java, Honey.java, LocalSource.java exist in entity/
4. V2__create_honey_tables.sql exists in db/migration/
5. Backend compiles without errors
6. Backend starts and Flyway applies V2 migration
</verification>

<success_criteria>
- 6 enum classes for controlled vocabularies with displayName methods
- Honey entity with all 17+ attributes from research
- LocalSource entity with location, contact, and verification metadata
- JPA auditing enabled, @CreatedDate/@LastModifiedDate work
- V2 migration creates tables and indexes in H2 (dev profile)
- Backend health check returns healthy after migration
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-foundation/02-01-SUMMARY.md`
</output>
