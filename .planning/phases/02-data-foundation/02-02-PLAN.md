---
phase: 02-data-foundation
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - backend/src/main/java/com/honeyexplorer/repository/HoneyRepository.java
  - backend/src/main/java/com/honeyexplorer/repository/LocalSourceRepository.java
  - backend/src/main/java/com/honeyexplorer/dto/EnumOption.java
  - backend/src/main/java/com/honeyexplorer/dto/FilterOptionsDTO.java
  - backend/src/main/java/com/honeyexplorer/controller/FilterController.java
  - backend/src/test/java/com/honeyexplorer/repository/HoneyRepositoryTest.java
  - backend/src/test/java/com/honeyexplorer/controller/FilterControllerTest.java
autonomous: true

must_haves:
  truths:
    - "GET /api/filters/options returns all available filter values with display names"
    - "Honey entities can be saved and retrieved via HoneyRepository"
    - "LocalSource entities can be saved and retrieved via LocalSourceRepository"
    - "Audit timestamps are automatically set when saving entities"
  artifacts:
    - path: "backend/src/main/java/com/honeyexplorer/repository/HoneyRepository.java"
      provides: "Honey data access"
      contains: "interface HoneyRepository"
    - path: "backend/src/main/java/com/honeyexplorer/controller/FilterController.java"
      provides: "Filter options API endpoint"
      contains: "@GetMapping"
    - path: "backend/src/main/java/com/honeyexplorer/dto/FilterOptionsDTO.java"
      provides: "Filter response structure"
      contains: "record FilterOptionsDTO"
  key_links:
    - from: "backend/src/main/java/com/honeyexplorer/controller/FilterController.java"
      to: "backend/src/main/java/com/honeyexplorer/entity/enums/FloralSource.java"
      via: "Arrays.stream(FloralSource.values())"
      pattern: "FloralSource\\.values\\(\\)"
    - from: "backend/src/main/java/com/honeyexplorer/repository/HoneyRepository.java"
      to: "backend/src/main/java/com/honeyexplorer/entity/Honey.java"
      via: "JpaRepository<Honey, UUID>"
      pattern: "JpaRepository<Honey"
---

<objective>
Create Spring Data JPA repositories and filter options API endpoint for faceted search

Purpose: Completes the data foundation by enabling data persistence and providing the API structure for Phase 5 faceted filtering. Returns empty but properly structured filter options (counts will be populated after Phase 3 seeding).

Output: 2 repositories, 2 DTOs, 1 REST controller, and integration tests proving the data layer works
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-foundation/02-RESEARCH.md
@.planning/phases/02-data-foundation/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Spring Data JPA repositories</name>
  <files>
    backend/src/main/java/com/honeyexplorer/repository/HoneyRepository.java
    backend/src/main/java/com/honeyexplorer/repository/LocalSourceRepository.java
  </files>
  <action>
    Create 2 repository interfaces in backend/src/main/java/com/honeyexplorer/repository/:

    1. HoneyRepository.java:
       - extends JpaRepository<Honey, UUID>
       - Add method signatures for future filtering (Phase 5 will implement):
         - Optional<Honey> findBySlug(String slug)
         - List<Honey> findByFloralSource(FloralSource floralSource)
         - List<Honey> findByOrigin(HoneyOrigin origin)
         - List<Honey> findByType(HoneyType type)

    2. LocalSourceRepository.java:
       - extends JpaRepository<LocalSource, UUID>
       - Add method signatures for future filtering (Phase 6 will implement):
         - List<LocalSource> findBySourceType(SourceType sourceType)
         - List<LocalSource> findByState(String state)
         - List<LocalSource> findByCity(String city)
         - List<LocalSource> findByIsActiveTrue()
  </action>
  <verify>
    Backend compiles with repositories:
    cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn compile -q
  </verify>
  <done>
    HoneyRepository and LocalSourceRepository interfaces extend JpaRepository with query method signatures
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DTOs and filter options endpoint</name>
  <files>
    backend/src/main/java/com/honeyexplorer/dto/EnumOption.java
    backend/src/main/java/com/honeyexplorer/dto/FilterOptionsDTO.java
    backend/src/main/java/com/honeyexplorer/controller/FilterController.java
  </files>
  <action>
    1. Create EnumOption.java record in dto/:
       ```java
       public record EnumOption(
           String value,      // Enum name (e.g., "ORANGE_BLOSSOM")
           String displayName, // Human readable (e.g., "Orange Blossom")
           Long count         // Number of matching items (0 for now)
       ) {}
       ```

    2. Create FilterOptionsDTO.java record in dto/:
       ```java
       public record FilterOptionsDTO(
           List<EnumOption> floralSources,
           List<EnumOption> origins,
           List<EnumOption> types,
           List<EnumOption> flavorProfiles,
           List<EnumOption> sourceTypes,
           List<EnumOption> certifications
       ) {}
       ```

    3. Create FilterController.java in controller/:
       - @RestController
       - @RequestMapping("/api/filters")
       - @GetMapping("/options") returns FilterOptionsDTO
       - Map each enum to List<EnumOption> using Arrays.stream():
         ```java
         Arrays.stream(FloralSource.values())
             .map(e -> new EnumOption(e.name(), e.getDisplayName(), 0L))
             .toList()
         ```
       - Return all filter options with count=0 (Phase 5 will add real counts)
  </action>
  <verify>
    Endpoint returns filter options:
    - Start backend: cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn spring-boot:run -Dspring-boot.run.profiles=dev &
    - Wait for startup (check for "Started HoneyExplorerApplication")
    - curl http://localhost:8080/api/filters/options | jq .
    - Response contains floralSources, origins, types, etc. arrays
    - Each array has objects with value, displayName, count fields
    - Kill backend process
  </verify>
  <done>
    GET /api/filters/options returns structured filter options with all enum values
  </done>
</task>

<task type="auto">
  <name>Task 3: Create integration tests and verify complete data layer</name>
  <files>
    backend/src/test/java/com/honeyexplorer/repository/HoneyRepositoryTest.java
    backend/src/test/java/com/honeyexplorer/controller/FilterControllerTest.java
  </files>
  <action>
    1. Create HoneyRepositoryTest.java in test/java/com/honeyexplorer/repository/:
       - @DataJpaTest annotation for repository testing
       - @AutoConfigureTestDatabase(replace = NONE) to use H2
       - Inject HoneyRepository
       - Test: saveAndFindHoney
         - Create Honey with required fields (name, floralSource, type, origin)
         - Save via repository
         - Find by ID
         - Assert all fields match
         - Assert createdAt and updatedAt are not null (auditing works)
       - Test: findByFloralSource
         - Save 2 honeys with different floral sources
         - Query by one floral source
         - Assert correct honey returned

    2. Create FilterControllerTest.java in test/java/com/honeyexplorer/controller/:
       - @WebMvcTest(FilterController.class) for controller testing
       - Inject MockMvc
       - Test: getFilterOptions_returnsAllEnumValues
         - GET /api/filters/options
         - Assert status 200
         - Assert floralSources array has correct count (same as FloralSource.values().length)
         - Assert first floralSource has value, displayName, count fields
       - Test: filterOptions_containsExpectedValues
         - GET /api/filters/options
         - Assert floralSources contains "CLOVER" and "MANUKA"
         - Assert origins contains "USA" and "NEW_ZEALAND"

    3. Run all tests to verify complete data layer:
       cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn test
  </action>
  <verify>
    All tests pass:
    cd /home/sam/claude-workspace/honey-explorer/backend && source ~/.sdkman/bin/sdkman-init.sh && mvn test

    Expected output: "Tests run: X, Failures: 0, Errors: 0"
  </verify>
  <done>
    - HoneyRepositoryTest proves entity persistence and auditing work
    - FilterControllerTest proves API returns correct filter structure
    - All tests pass with mvn test
  </done>
</task>

</tasks>

<verification>
Phase 2 Plan 02 verification:
1. HoneyRepository.java and LocalSourceRepository.java exist with query methods
2. EnumOption.java and FilterOptionsDTO.java records exist
3. FilterController.java exposes GET /api/filters/options
4. HoneyRepositoryTest.java proves persistence and auditing
5. FilterControllerTest.java proves API structure
6. All tests pass (mvn test exits with 0)
7. Manual curl to /api/filters/options returns valid JSON
</verification>

<success_criteria>
- HoneyRepository and LocalSourceRepository extend JpaRepository
- GET /api/filters/options returns FilterOptionsDTO with all enum values
- Each EnumOption has value (enum name), displayName (human readable), count (0)
- Repository tests prove Honey can be saved with auto-generated UUID and audit timestamps
- Controller tests prove API returns correct structure
- All tests pass: mvn test shows 0 failures
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-foundation/02-02-SUMMARY.md`
</output>
